# 基础篇：经常说的 CPU 上下文切换是什么意思？（上）

> [!ATTENTION]
> 从上一章可知，多进程在竞争 CPU 的时候，并没有真正运行，为什么还会导致系统的负载升高呢？其实，CPU 上下文切换，就是这个罪魁祸首。

## CPU 上下文概念

Linux 是一个多任务操作系统，它支持远大于 CPU 数量的任务同时运行。当然，这些任务实际上不是真的在同时运行，而是因为系统在很短的时间内，将 CPU 轮流分配给它们，造成多任务同时运行的错觉。

### CPU 寄存器与程序计数器

每个任务运行前，CPU 都需要知道任务从哪里加载、又是从哪里开始运行，也就是说需要系统事先帮它设置好 **CPU 寄存器和程序计数器（Program Counter，PC）**。
CPU 寄存器：是CPU 内置的容量小、但是速度极快的内存。
程序计数器：是用来存储 CPU 正在执行的指令位置、或者即将执行的下一条指令位置。
它们都是 CPU 在运行任何任务前，必须依赖的环境，因此，也被称作 —— **CPU 上下文**。

### CPU 上下文切换

CPU 上下文切换，就是先把前一个任务的 CPU 上下文（也就是 CPU 寄存器和程序计数器）保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，最后，再跳转到程序计数器所指的新位置，运行新任务。而这些保存起来的上下文，会存储到系统内核中，并在任务重新调度执行时，再次加载进来。这样，就能保证任务原来的状态不受影响，让任务看起来还是在连续运行。

## CPU 上下文切换三种场景

根据任务的不同，CPU 的上下文切换可以分为几个不同的场景，也就是——
- **进程上下文切换**
- **线程上下文切换**
- **中断上下文切换**

### 进程上下文切换

#### 进程运行空间
#### 触发进程调度的场景
1. 
2. 
3. 
4. 
5. 


### 线程上下文切换

#### 线程与进程区别

### 中断上下文切换

## 小结

1. CPU 上下文切换，是保证 Linux 系统正常工作的核心功能之一，一般情况下，不需要我们特别关注。
2. 但是，过多的上下文切换，会把 CPU 时间，消耗在寄存器、内核栈以及虚拟内存等数据的保存和恢复上，从而缩短进程真正运行的时间，导致系统的整体性能大幅下降。

## 拓展