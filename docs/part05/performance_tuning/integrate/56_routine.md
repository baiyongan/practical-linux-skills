# 套路篇：应用监控的一般思路

## 指标监控

!!! tips
    与系统监控一样，在构建应用程序的监控系统之前，首先需要确定，到底需要监控哪些指标。特别是要清楚，有哪些指标可以用来快速确认应用程序的性能问题。

!!! attention
    **应用程序的核心指标，不再时资源的使用情况，而是请求数、错误率和响应时间。**
    这些指标不仅直接关系到用户的使用体验，还反映应用整体的可用性和可靠性。

根据以上三个黄金指标，可以快速知道，应用是否发生了性能问题，

根据以下几类指标，可以快速定位“性能瓶颈区”。这也是监控应用程序时必不可少的。

### 第一个：应用进程的资源使用情况

比如进程占用的 CPU、内存、磁盘 I/O、网络等。使用过多的系统资源，导致应用程序响应缓慢或者错误数升高，是一个最常见的性能问题。

### 第二个：应用程序之间的调用情况

比如调用频率、错误数、延时等。

### 应用程序内部核心逻辑的运行情况

比如关键环节的耗时以及执行过程中的错误等。鉴于这是通常从外部无法直接获取的性能数据。所以，应用程序在设计和开发时，就应该把这些指标提供出来，以便监控系统可以了解其内部运行状态。

!!! tips
    由于业务系统通常会涉及到一连串的多个服务，形成一个复杂的分布式调用链。为了迅速定位这类跨应用的性能瓶颈，还可以使用 Zipkin、Jaeger、Pinpoint 等各类开源工具，来构建全链路跟踪系统。

    全链路跟踪可以帮你迅速定位出，在一个请求处理过程中，哪个环节才是问题根源。

## 日志监控

指标，是特定时间段的数值型测量数据，通常以时间序列的方式处理，适合实时监控。

日志，则是某个时间点的字符串消息，通常需要对搜索引擎进行索引后，才能进行查询和汇总分析。

日志监控的经典技术栈 —— ELK，即 Elasticsearch、Logstash、Kibana。

- Logstash 负责对哥哥日志元采集，然后预处理，发送给 Elasticsearch 进行索引；
- Elasticsearch 负责对日志进行索引，并提供了一个完整的全文搜索引擎；
- Kibana 负责对日志可视化分析。

!!! note
    Logstash 资源消耗较大，可以用 Fluentd 来替代。

## 小结

应用程序的监控，可以分为指标监控和日志监控两大部分：

指标监控：主要是对一定时间段内性能指标进行测量，然后再通过时间序列的方式，进行处理、存储和告警。

日志监控：可以提供更详细的上下文信息，通常通过 ELK 技术栈来进行收集、索引和图形化展示。

在跨多个不同应用的复杂业务场景中，还可以构建全链路跟踪系统。这样可以动态跟踪调用链中各个组件的性能，生成整个流程的调用拓扑图，从而加快定位复杂应用的性能问题。
