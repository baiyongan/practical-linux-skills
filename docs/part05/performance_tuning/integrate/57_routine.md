# 套路篇：分析性能问题的一般步骤

## 系统资源瓶颈

系统资源的瓶颈，是最为常见的性能问题。可以通过 USE 法，即使用率、饱和度以及错误数这三类指标来衡量。

系统资源可以分为硬件资源和软件资源两类。

典型的硬件资源：CPU、内存、磁盘、文件系统以及网络等；

典型的软件资源：文件描述符数、连接跟踪数、套接字缓冲区大小等。


## CPU 性能分析

!!! tips
    利用 top、vmstat、pidstat、strace 以及 perf 等几个最常见的工具，获取 CPU 性能指标后，再结合进程与 CPU 的工作原理，就可以迅速定位出 CPU 性能瓶颈的来源。

    top、pidstat、vmstat 这类工具所汇报的 CPU 性能指标，都源自于 /proc 文件系统（如 /proc/loadavg、/proc/stat、/proc/softirqs 等）。

- 可以用 strace，查看进程的系统调用汇总；
- 可以用 perf，找出进程的热点函数；
- 可以用动态追踪的方法，观察进程的当前执行过程，直到确定瓶颈的根源。

## 内存性能分析



## 磁盘和文件系统 I/O 性能分析


## 网络性能分析


## 应用程序瓶颈


## 小结

系统资源瓶颈角度 —— USE 法最有效

应用程序瓶颈角度 —— 性能问题的来源分为资源瓶颈、依赖服务瓶颈，以及应用自身瓶颈三类。

- 资源瓶颈和系统资源瓶颈，本质一样。
- 依赖服务瓶颈，可以用全链路跟踪系统定位。
- 应用自身瓶颈，可以通过系统调用、热点函数，或者应用自身的指标监控以及日志监控等，进行分析定位。

!!! attention
    实际运行中，系统和应用往往相辅相成，相互影响。系**统是应用的运行环境，系统的瓶颈会导致应用的性能下降；而应用的不合理设计，也会引发系统资源的瓶颈。**
